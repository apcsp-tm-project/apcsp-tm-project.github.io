<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesture-Controlled Interactive Webpage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            transition: background-color 0.5s ease;
        }
        header {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #instructions {
            margin: 20px auto;
            max-width: 600px;
            text-align: left;
        }
        #quoteBox {
            margin-top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        #randomImage {
            margin-top: 20px;
            max-width: 250px;
            display: none;
        }
        #videoPlayer {
            margin-top: 20px;
            width: 320px;
            height: 240px;
        }
    </style>
</head>
<body>

<header>Hand Gesture Interactive Demo</header>

<section id="intro">
    <p>
        This webpage demonstrates how machine learning and hand gestures can be used to control interactive elements.
        It is designed for students, educators, and developers interested in AI, computer vision, and accessible user interaction.
        Users who benefit include people wanting hands-free controls, classrooms experimenting with ML, and beginners exploring Teachable Machine.
    </p>
</section>

<section id="instructions">
    <h2>How to Use</h2>
    <ul>
        <li><strong>üëç Thumbs Up:</strong> Show a motivational quote</li>
        <li><strong>‚úåÔ∏è Peace Sign:</strong> Change the background color</li>
        <li><strong>‚úã Open Palm:</strong> Play/Pause the video</li>
        <li><strong>üëä Fist:</strong> Show a random image or fact</li>
    </ul>
</section>

<button type="button" onclick="init()">Start Webcam</button>
<div id="webcam-container"></div>
<div id="label-container"></div>

<div id="quoteBox"></div>
<img id="randomImage" />

<video id="videoPlayer" controls>
    <source src="sample.mp4" type="video/mp4" />
</video>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
    const URL = "./my_model/";
    let model, webcam, labelContainer, maxPredictions;
    // Gesture cooldown
 let lastGesture = "";
 let lastTriggerTime = 0;
 const COOLDOWN = 2000;

    const quotes = [
        "Believe in yourself!",
        "You are capable of amazing things!",
        "Keep going, you're doing great!",
        "Every day is a new opportunity!"
    ];

    const images = [
        "img1.jpg",
        "img2.jpg",
        "img3.jpg"
    ];

    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        const flip = true;
        webcam = new tmImage.Webcam(200, 200, flip);
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loop);

        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
    }

    function changeBackground() {
        const colors = ["#f8e8ff", "#e0f7ff", "#ffe9e0", "#e8ffe2", "#fffad1"];
        document.body.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    }

    function showQuote() {
        const q = quotes[Math.floor(Math.random() * quotes.length)];
        document.getElementById("quoteBox").innerText = q;
    }

    function toggleVideo() {
        const video = document.getElementById("videoPlayer");
        if (video.paused) video.play();
        else video.pause();
    }

    function showRandomImage() {
        const img = document.getElementById("randomImage");
        img.src = images[Math.floor(Math.random() * images.length)];
        img.style.display = "block";
    }

async function predict() {
    const prediction = await model.predict(webcam.canvas);

    let highestClass = null;
    let highestProb = 0;

    for (let i = 0; i < prediction.length; i++) {
        if (prediction[i].probability > highestProb) {
            highestProb = prediction[i].probability;
            highestClass = prediction[i].className;
        }
        labelContainer.childNodes[i].innerHTML =
            prediction[i].className + ": " + prediction[i].probability.toFixed(2);
    }

    // Cooldown: prevent constant firing
    const now = Date.now();

    if (
        highestProb > 0.90 &&
        highestClass !== lastGesture &&
        now - lastTriggerTime > COOLDOWN
    ) {
        lastGesture = highestClass;
        lastTriggerTime = now;

        console.log("Gesture Activated:", highestClass);

        if (highestClass === "MotQuote") showQuote();
        if (highestClass === "Backcolor") changeBackground();
        if (highestClass === "Playvid") toggleVideo();
        if (highestClass === "Showimg") showRandomImage();
    }
}
</script>

</body>
</html>